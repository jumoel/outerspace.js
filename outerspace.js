var net = require('net');
 
net.createServer(function (client) {
	console.log("client connected");
 
	client.on('data', function (data) {
		var request = data.toString('hex');
 
		var response = null;
		if (/^00000008010000000[c,0,a]000000$/i.test(request)) { // hello - 0 = first login, c = regular login, a = game start
			response = new Buffer("0000000c02000000a35a655383e2c8b0", "hex");
		}
		else if (/^0000008c/i.test(request)) { // login
			response = new Buffer("000000050500000000", "hex"); // valid username
		}
		else if (/^0000000515000000(00|ff)$/i.test(request)) { // expirydate
			// set expiry date to next year
			var hex = new Buffer("0000002117000000010000004d6f6e204d61792020352031343a32363a333620", "hex");
			var year = (new Date()).getFullYear() + 1;
 
			response = new Buffer(hex + year + new Buffer("00", "hex"));
		}
		else if (/^000000210a000000/i.test(request)) { // on starting submodule ??
			response = new Buffer("000000200b000000010000001000000005cbf1f4568bf18b06ff50048b068bce5eff6008000000700b0000000300000060000000321cdd28538bd98b03ff90d400000085c074438b138bcb565750ff92d0000000ffd08bf8538bcf8b17ff52488b178bcf8b33ff520c508bcbff96c80000008b078bcf8b33ff5008508bcbff96c40000005f5eb0015bc332c05bc3cccccccccccccccccccc000000050c00000000", "hex");
		}
		else if (/^000000200a0000000c000000496e6e65722053706163652055706c696e6b20312e313300$/i.test(request)) { // regular version test ??
			response = new Buffer("000000700b00000002000000600000001d2b5b675355568b7424108be9578b7c2418578b5d0056ff93dc00000050ff7424288b45008bcdff742428ff7424285756ff90d4000000508b45008bcd565756ff90d8000000508b83e40000008bcdffd05f5e5d5bc21400cccccccccccccccccccccccc000000700b0000000700000060000000102316a2538bd98b03ff90ec00000085c074438b138bcb565750ff92e8000000ffd08bf8538bcf8b17ff52488b178bcf8b33ff520c508bcbff96cc0000008b078bcf8b33ff5008508bcbff96c80000005f5eb0015bc332c05bc3cccccccccccccccccccc000000300b0000000300000020000000c3bc1d1a8b89fc00000085c9750332c0c38b018b4010ffe0cccccccccccccccccccccccc000000500b0000000400000040000000857c0b97568bf18b8efc00000085c9751f8b068bce8b4018ffd084c0740e8b8efc0000005e8b018b4018ffe032c05ec38b015e8b4018ffe0cccccccccccccccccccccccc000000300b00000005000000200000004e5a35558b89fc00000085c974078b016a00ff5004c3cccccccccccccccccccccccccccc000000700b00000006000000600000002ea6df7d578bf983bffc00000000744e8b07ff742408ff503c8bd085d2743f8b8ffc0000000fb64258568b310fb64a5a510fb64a595150ff72548b078bcfff7250ff724cff742428ff7208ff50148b8ffc000000508b06ffd05e5fc2080032c05fc20800000000050c00000000", "hex");
		}
		else if (/^000000200a0000000d000000496e6e6572205370616365204b65726e656c20312e313300/i.test(request)) { // regular version test ??
			response = new Buffer("000001000b00000001000000f0000000ba269ff2568b742408578bf9568b078b808c010000ffd084c074075f33c05ec208008b078bcf5356ff90300200008b5c24148bc8890b85c90f84930000008b07518bcfff90540200008bcf85c078128b07ff33ff90340200005b5f33c05ec208008b37ff963802000050ff338bcfff963c0200008bf08bcf8b0785f674d3ff906401000050ffd68bf083c40485f6751f8b078bcf56ff902c0200008b078bcfff33ff90340200005b5f33c05ec208008b068bceff1083f834741f8b178bcf50ff922c0200008b078bcfff33ff90340200005b5f33c05ec208008b068bce578b4004ffd084c074de5b5f8bc65ec20800cccccccccc000000200b0000000200000010000000175751218bd18b4c24048b01895424048b00ffe0000000050c00000000", "hex");
		}
		else if (/^0000002406000000/i.test(request)) { // file hashes ??
			response = new Buffer("0000077e08000000720700009be28da2313a4c6176697368506174636865722e6578653a3132393032343a2d313431383635373837350d0a323a4c61766973682e646c6c3a3135303532383a2d3634313837303236340d0a343a4c617669736843726173684d6f62696c652e6578653a39363235363a2d313837383033323430360d0a333a496e6e657253706163652e7478743a3137393036323a2d313638353337353838360d0a31303a496e6e657253706163652e6578653a3731353236343a2d3132333035373234350d0a31313a496e6e657253706163652e646c6c3a3433383738343a2d3736363931343132310d0a31323a49532d443344382e646c6c3a3431363736383a3839363130383733380d0a31333a49532d443344392e646c6c3a3138393935323a3239383937363737360d0a31383a49532d4f70656e474c2e646c6c3a313035333138343a2d313235313335343139380d0a32313a495355492e646c6c3a3936333037323a2d3935303537373232300d0a32323a496e746572666163655c57696e646f77436f6e74726f6c732e706e673a3730343a32363535353239340d0a32343a496e746572666163655c427574746f6e2e706e673a313032313a2d313533343733303236360d0a32353a496e746572666163655c436865636b426f782e706e673a3936393a2d37383633383237330d0a32363a496e746572666163655c44656661756c7455492e786d6c3a343136313a3438363831303035370d0a32373a496e746572666163655c536c696465722e706e673a313033313a2d3634323837323930330d0a32383a496e746572666163655c47617567652e706e673a3738303a2d3137343239393635330d0a32393a496e746572666163655c5363726f6c6c4261722e706e673a3830313a2d313733353933373436350d0a33303a496e746572666163655c44656661756c74536b696e2e786d6c3a33353435383a2d313938393635333337360d0a33313a496e746572666163655c546162436f6e74726f6c2e706e673a3939363a2d32353639353635330d0a33323a496e746572666163655c436f6d626f426f782e706e673a3638333a313832313835353234340d0a33343a47616d65446574656374696f6e2e584d4c3a33323134333a313436343435393330300d0a33373a536372697074735c44656661756c74537461727475702e6973733a383531333a313530343936373430360d0a33383a536372697074735c44656661756c74507265537461727475702e6973733a3533323a2d313732373539333334370d0a33393a49532d4b65726e656c2e646c6c3a323038393938343a2d3133363037393231340d0a34303a496e746572666163655c44656661756c7455706c696e6b55492e786d6c3a37323832333a2d313338343532343130300d0a34313a49532d44334439456e67696e652e646c6c3a3131383738343a313436343134363930390d0a34333a49532d5669727475616c496e7075742e646c6c3a3233373035363a3838383035373939300d0a34343a4c6176697368536372697074204d6f64756c65735c546172677a2e646c6c3a3135353634383a313437333233353934330d0a34353a4c61766973682e496e6e657253706163652e646c6c3a35303137363a2d313438343439303735320d0a34363a4c61766973682e4c6176697368564d52756e74696d652e646c6c3a31323238383a2d3239313935363931370d0a34373a4c61766973682e4c61766973684e61762e646c6c3a32333535323a313339313534373036360d0a34383a4c61766973682e496e6e657253706163652e786d6c3a36313235343a313836333735393030320d0a34393a4c61766973682e4c61766973684e61762e786d6c3a33393236323a2d313633353831343131390d0a35303a2e4e45542050726f6772616d735c49532d446f744e65745363726970742e6578653a383730343a2d313130383230303532350d0a35313a49532d4433443131456e67696e652e646c6c3a3134303238383a313335313538323734350d0a35323a49532d44334431312e646c6c3a3230363333363a2d3236303633353635320d0a35333a7836345c496e6e657253706163652e6578653a3833363039363a313330373736333630390d0a35343a7836345c4c61766973682e646c6c3a3137313532303a3230323031363738330d0a35353a7836345c496e6e657253706163652e646c6c3a3533343031363a2d3233343632303239360d0a35363a7836345c49532d44334431312e646c6c3a3237383031363a2d313634303937333935360d0a35373a7836345c49532d4433443131456e67696e652e646c6c3a3136343335323a2d3338393239303335370d0a35383a7836345c49532d443344392e646c6c3a3233333437323a2d3630313637333634350d0a35393a7836345c49532d44334439456e67696e652e646c6c3a3134353932303a2d3431363337303438380d0a36303a7836345c49532d4b65726e656c2e646c6c3a323535323332303a2d3436363033383630360d0a36313a7836345c49532d5669727475616c496e7075742e646c6c3a3238343136303a313531363239333331340d0a36323a7836345c495355492e646c6c3a313138353739323a32363737383735380d0a", "hex");
		}
		else if (/^0000002706000000/i.test(request)) { // first run, version test and download of installer ??
			// TODO
		}
		else if (/^000000100d000000/i.test(request)) { // is this game approved ??
			response = new Buffer("000000050f00000000", "hex");
		}
		else {
			console.log("UNKNOWN REQUEST");
		}
 
		console.log("request: " + request);
 
		client.write(response, "binary", function() {
			console.log("response: " + response.toString("hex"));
		});
	});
})
 
.listen(11500);
